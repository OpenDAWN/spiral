!function(window){"use strict";var hasWebKitAudioContext=(function(){var tem,ua=navigator.userAgent,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(M[1])?(tem=/\brv[ :]+(\d+)/g.exec(ua)||[],"IE "+(tem[1]||"")):"Chrome"===M[1]&&(tem=ua.match(/\bOPR\/(\d+)/),null!==tem)?"Opera "+tem[1]:(M=M[2]?[M[1],M[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(tem=ua.match(/version\/(\d+)/i))&&M.splice(1,1,tem[1]),M.join(" "))}(),window.hasOwnProperty("webkitAudioContext")),hasAudioContext=window.hasOwnProperty("AudioContext");if(!hasWebKitAudioContext&&!hasAudioContext)return console.log("[Spiral] This browser does not support Web Audio API."),void(window._SPIRALFATAL=!0);hasWebKitAudioContext&&!hasAudioContext&&(window.AudioContext=window.webkitAudioContext,console.log("[Spiral] This browser still has webkitAudioContext. Patch applied."));var DEPRECATED_DICT={AudioContext:{createDelayNode:"createDelay",createGainNode:"createGain",createJavaScriptNode:"createScriptProcessor",createWaveTable:"createPeriodicWave"},AudioParam:{setTargetValueAtTime:"setTargetAtTime"},OscillatorNode:{noteOn:"start",noteOff:"stop",setWaveTable:"setPeriodicWave"},AudioBufferSourceNode:{noteOn:"start",noteOff:"stop"}};for(var nameSpace in DEPRECATED_DICT){var newMethods=DEPRECATED_DICT[nameSpace];for(var oldMethod in newMethods)window[nameSpace].prototype[oldMethod]=window[nameSpace].prototype[newMethods[oldMethod]]}}(window);
!function(){"use strict";window.Spiral=new Object;var SPIRAL_VERSION="0.0.1",EPSILON=.001;Object.defineProperties(window.AudioContext.prototype,{now:{get:function(){return this.currentTime}},DAC:{get:function(){return this.destination}},loadAudioFile:{value:function(fileURL){var _ctx=this,_promiseBody=function(resolve,reject){var xhr=new XMLHttpRequest;xhr.open("GET",fileURL,!0),xhr.responseType="arraybuffer",xhr.onload=function(event){if(200===xhr.status)_ctx.decodeAudioData(xhr.response,resolve,reject);else{var errorMessage="[Spiral] XHR "+xhr.status+" "+xhr.statusText+". ("+fileURL+")";reject(errorMessage)}},xhr.onerror=function(event){reject("[Spiral] XHR Network failure. ("+fileURL+")")},xhr.send()};return new Promise(_promiseBody)}},createNodes:{value:function(target,nodeList){if("object"!=typeof target)throw"[Spiral] Creation target is not an object.";for(var name in nodeList){var functionName="create"+nodeList[name];if("function"!=typeof this[functionName])throw"[Spiral] Invalid AudioNode constructor: "+functionName;target[name]=this[functionName]()}}}}),Object.defineProperties(window.AudioNode.prototype,{to:{value:function(){if(arguments.length>0){for(var i=0;i<arguments.length;i++)this.connect(arguments[i]);return arguments[0]}return this}},cut:{value:function(){this.disconnect()}}}),Object.defineProperties(window.AudioParam.prototype,{step:{value:function(){if(arguments[0]instanceof Array)for(var i=0;i<arguments.length;i++)this.setValueAtTime.apply(this,arguments[i]);else this.setValueAtTime.apply(this,arguments);return this}},line:{value:function(){if(arguments[0]instanceof Array)for(var i=0;i<arguments.length;i++)this.linearRampToValueAtTime.apply(this,arguments[i]);else this.linearRampToValueAtTime.apply(this,arguments);return this}},expo:{value:function(){if(arguments[0]instanceof Array)for(var i=0;i<arguments.length;i++)this.exponentialRampToValueAtTime.apply(this,arguments[i]);else this.exponentialRampToValueAtTime.apply(this,arguments);return this}},slew:{value:function(targetValue,startTime,duration){var safeTargetValue=Math.max(EPSILON,targetValue),tau=duration/Math.log(1/safeTargetValue);return this.setTargetAtTime(safeTargetValue,startTime,tau),this.setValueAtTime(safeTargetValue,startTime+duration),this.linearRampToValueAtTime(targetValue,startTime+duration),this}}}),Object.defineProperties(window.Spiral,{version:{get:function(){return SPIRAL_VERSION}},generateUid:{value:function(){return"yxxxxxxx".replace(/[xy]/g,function(c){var r=8*Math.random()|0,v="x"==c?r:3&r|8;return v.toString(16)})}}})}();